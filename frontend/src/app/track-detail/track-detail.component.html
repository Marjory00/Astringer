<div class="detail-container">

  <ng-container *ngIf="shipment$ | async as shipment; else notFound">

    <div class="tracking-header-actions">
      <div class="tracking-header">
        <h2>Shipment ID: {{ shipment.id }}</h2>

        <button class="copy-button" (click)="copyTrackingId(shipment.id)">
            📋 Copy ID
        </button>
      </div>

      <span class="status status-{{ shipment.status | statusClass }}">
        {{ shipment.status }}
      </span>
    </div>

    <div class="info-block">
      <h3>Current Status</h3>
      <p>The parcel is currently at: **{{ shipment.location }}**</p>
      <p>Expected arrival date: **{{ shipment.estimatedDelivery }}**</p>
    </div>

    <div class="map-container">
      <h3>Live Location</h3>
      <img
        [src]="'assets/maps/' + (shipment.location.split(',')[0] | lowercase) + '.png'"
        alt="Map location for {{ shipment.location }}"
        class="location-map"
      >
      <p class="map-caption">Last scanned location: {{ shipment.location }}</p>
    </div>

    <div class="timeline">
      <h3>Timeline</h3>

      <div class="timeline-item delivered" *ngIf="(shipment.status | statusClass) === 'delivered'">
        <div class="dot"></div>
        <div class="content">Delivered to final destination. ({{ shipment.estimatedDelivery }})</div>
      </div>

      <div class="timeline-item out"
           *ngIf="(shipment.status | statusClass) === 'out' || (shipment.status | statusClass) === 'delivered'">
        <div class="dot"></div>
        <div class="content">Out for delivery in local area.</div>
      </div>

      <div class="timeline-item transit"
           *ngIf="(shipment.status | statusClass) === 'in' || (shipment.status | statusClass) === 'out' || (shipment.status | statusClass) === 'delivered'">
        <div class="dot"></div>
        <div class="content">In Transit from sorting facility ({{ shipment.location }}).</div>
      </div>

      <div class="timeline-item created">
        <div class="dot"></div>
        <div class="content">Shipment label created and handed over to courier.</div>
      </div>
    </div>
  </ng-container>

  <ng-template #notFound>
    <div class="error-message">
      <h2>Tracking ID Not Found 😞</h2>
      <p>The tracking ID entered is invalid or the shipment has not been registered yet.</p>
      <p>Returning to the dashboard shortly...</p>
    </div>
  </ng-template>

  <button class="back-button" routerLink="/">← Back to Dashboard</button>
</div>
