<div class="track-detail-container">

  <div class="page-header-row">
    <h1 class="page-header"><i class="fas fa-search-location"></i> Shipment Tracking</h1>
    <button (click)="router.navigate(['/dashboard'])" class="back-button"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i> Loading tracking information for ID: {{ trackingId }}...
  </div>

  <div *ngIf="error && !isLoading" class="error-state">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
    <p *ngIf="trackingId">Please verify the Tracking ID: **{{ trackingId }}**</p>
  </div>

  <ng-container *ngIf="!isLoading && !error">
    <div *ngIf="(shipment$ | async) as shipment; else notFound">

      <div class="details-grid">

        <div class="info-card status-card" [ngClass]="['status-' + shipment.status.toLowerCase().replace(' ', '-')]">
          <h2>Shipment Status</h2>
          <p class="current-status">{{ shipment.status }}</p>
          <div class="eta">
            <i class="fas fa-clock"></i>
            ETA: **{{ shipment.estimatedDelivery | date:'fullDate' }}**
          </div>
          <p class="tracking-id-display">
            Tracking ID: **{{ shipment.trackingId }}**
          </p>
          <button class="copy-button" (click)="copyTrackingId(shipment.trackingId)">
            <i class="fas fa-copy"></i> Copy ID
          </button>
        </div>

        <div class="info-card route-card">
          <h2>Route Information</h2>
          <div class="route-info-detail">
            <div class="route-item origin"><i class="fas fa-warehouse"></i> **Origin:** {{ shipment.origin }}</div>
            <div class="route-arrow"><i class="fas fa-route"></i></div>
            <div class="route-item destination"><i class="fas fa-map-marked-alt"></i> **Destination:** {{ shipment.destination }}</div>
          </div>
        </div>

      </div>

      <div class="info-card timeline-card">
        <h2>Detailed Timeline</h2>

        <div class="timeline">
          <div class="timeline-item"
               [ngClass]="{ 'item-complete': event.isComplete }"
               *ngFor="let event of shipment.trackingHistory; trackBy: event.timestamp">

            <div class="event-details">
              <div class="event-info">
                <div class="event-title">{{ event.status }}</div>
                <div class="event-location"><i class="fas fa-map-marker-alt"></i> {{ event.location }}</div>
              </div>
              <div class="event-timestamp">
                {{ event.timestamp | date:'medium' }}
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </ng-container>

  <ng-template #notFound>
    <div *ngIf="!isLoading && !error" class="empty-state">
      <i class="fas fa-question-circle"></i> Tracking ID **{{ trackingId }}** not found.
    </div>
  </ng-template>

</div>
